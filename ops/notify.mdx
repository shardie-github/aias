# Alert Notification System

## Overview

The alert notification system sends automated alerts to configured webhooks when regressions persist for 3+ cycles.

## Configuration

Webhook URLs are configured via environment variables (secrets):

- `RELIABILITY_ALERT_WEBHOOK` - For performance/reliability regressions
- `SECURITY_ALERT_WEBHOOK` - For security incidents
- `COST_ALERT_WEBHOOK` - For budget overruns

**Note:** These are secret names only. Never commit actual webhook URLs to the repository.

## Usage

The notification utility is located at `ops/notify.ts` and provides:

- `sendAlert(payload)` - Send alert to configured webhook
- `shouldAlert(regressionCount, threshold)` - Check if alert should be sent
- Helper functions for common alert types

## Alert Types

### Reliability Alerts
Triggered when performance metrics exceed SLO thresholds for 3+ cycles.

**Example:**
```typescript
import { sendAlert, createReliabilityAlert } from "@/ops/notify";

const alert = createReliabilityAlert("api_p95_ms", 500, 400, 3);
await sendAlert(alert);
```

### Security Alerts
Triggered when security issues are detected.

**Example:**
```typescript
import { sendAlert, createSecurityAlert } from "@/ops/notify";

const alert = createSecurityAlert("Secrets exposed", "high", {
  count: 2,
  files: ["config.example.json"]
});
await sendAlert(alert);
```

### Cost Alerts
Triggered when spending approaches or exceeds budget thresholds.

**Example:**
```typescript
import { sendAlert, createCostAlert } from "@/ops/notify";

const alert = createCostAlert("vercel", 75, 50, 150);
await sendAlert(alert);
```

## Integration with Agent

The Hardonia Ops Agent uses this utility when:
- Performance regressions persist 3+ cycles
- Security issues are detected
- Budget thresholds are exceeded

Alerts are automatically included in agent reports and linked to relevant runbooks.

## Webhook Format

Alerts are sent as JSON payloads compatible with Slack/Discord webhooks:

```json
{
  "text": "ðŸš¨ HIGH: Performance Regression: api_p95_ms",
  "blocks": [
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*Performance Regression: api_p95_ms*\n..."
      }
    }
  ]
}
```

## Testing

To test alert functionality without sending real alerts:

```typescript
// Check if webhook is configured
const webhookUrl = getWebhookUrl("reliability");
console.log("Webhook configured:", !!webhookUrl);

// Create test alert (won't send if webhook not configured)
const testAlert = createReliabilityAlert("test_metric", 100, 50, 3);
const sent = await sendAlert(testAlert);
console.log("Alert sent:", sent);
```

---

**Maintained By:** Hardonia Ops Agent  
**Last Updated:** {{ date }}
