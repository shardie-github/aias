> Archived on 2025-11-12. Superseded by: (see docs/final index)

# Type Oracle â€” Type Coverage Report

**Generated:** 2025-01-27  
**Target Coverage:** 95%  
**Current Status:** Analysis Complete

## Executive Summary

This report analyzes TypeScript type coverage across the codebase using multiple tools:
- `tsc --noEmit` (TypeScript compiler)
- `ts-prune` (unused exports)
- Manual code analysis

## Findings

### TypeScript Configuration

**Current Config (`tsconfig.json`):**
- âœ… `strict: true` â€” Enabled
- âœ… `noUnusedLocals: true` â€” Enabled
- âœ… `noUnusedParameters: true` â€” Enabled
- âœ… `skipLibCheck: true` â€” Enabled (acceptable for performance)
- âœ… `isolatedModules: true` â€” Enabled

**Status:** Strong TypeScript configuration with strict mode enabled.

### Unused Exports (ts-prune)

**Total Unused Exports Found:** 891+ (from `reports/ts-prune.txt`)

**Key Categories:**
1. **Middleware/Config Exports** â€” Many middleware configs marked as unused but may be used by framework
2. **AI Agent Exports** â€” Some orchestrator types exported but not imported elsewhere
3. **Guardian Types** â€” RiskLevel, ResponseAction exported but potentially only used internally
4. **Component Variants** â€” Some UI component variant functions exported but unused

**Recommendations:**
- Review middleware exports â€” Next.js may use them implicitly
- Consider making AI agent types internal unless needed by external consumers
- Audit Guardian exports â€” may be used by runtime checks

### Type Safety Gaps

**Identified Issues:**

1. **Missing Type Annotations:**
   - Some API route handlers use `any` implicitly
   - Event handlers in components may lack proper typing
   - Generic utility functions could benefit from stricter constraints

2. **Unsafe Type Assertions:**
   - Some `as` casts found in error handling paths
   - Database query results may use unsafe assertions

3. **Missing Return Types:**
   - Some async functions lack explicit return types
   - Event handler functions could be more strictly typed

### Coverage Estimate

**Estimated Type Coverage:** ~85-90%

**Breakdown:**
- Core library code: ~95% (strong typing)
- Component code: ~90% (React types well-defined)
- API routes: ~85% (some any usage)
- Scripts/utilities: ~80% (looser typing acceptable)

## Recommendations

### Wave 1: Strengthen Typing (â‰¤30 Safe Edits)

1. **Add Explicit Return Types** (10 files)
   - API route handlers: `app/api/**/*.ts`
   - Async utility functions: `lib/**/*.ts`
   - Event handlers in components

2. **Replace `any` with Proper Types** (15 files)
   - Error handling: use `unknown` instead of `any`
   - API responses: define response types
   - Database queries: use Prisma-generated types

3. **Add Strict TS Flags** (if missing)
   - `noImplicitAny: true` (already enabled via `strict`)
   - `strictNullChecks: true` (already enabled via `strict`)
   - Consider `noUncheckedIndexedAccess: true` for extra safety

4. **Type Guard Functions** (5 files)
   - Add runtime type guards for API responses
   - Validate external data with Zod schemas (already in use)

### Files Requiring Attention

**High Priority:**
- `lib/env.ts` â€” Environment variable access could be more strictly typed
- `lib/api/route-handler.ts` â€” Route handler types could be stricter
- `app/api/**/*.ts` â€” API routes need explicit response types

**Medium Priority:**
- `components/**/*.tsx` â€” Some event handlers lack proper types
- `lib/validation/runtime-validation.ts` â€” Already good, but could add more guards

**Low Priority:**
- `scripts/**/*.ts` â€” Scripts can remain loosely typed for flexibility

## Metrics

| Metric | Current | Target | Status |
|--------|---------|--------|--------|
| Strict Mode | âœ… Enabled | âœ… Enabled | âœ… |
| Type Coverage | ~87% | 95% | ðŸŸ¡ |
| Unused Exports | 891+ | <100 | ðŸ”´ |
| `any` Usage | ~15 instances | 0 | ðŸŸ¡ |
| Missing Return Types | ~20 functions | 0 | ðŸŸ¡ |

## Next Steps

1. **Immediate:** Review and fix unused exports (may be false positives)
2. **Wave 1 PR:** Add explicit return types to API routes and utilities
3. **Wave 2:** Replace remaining `any` with proper types
4. **Wave 3:** Add type guards and runtime validation

## Notes

- Some "unused" exports may be used by Next.js framework (middleware, configs)
- Type coverage estimate based on code analysis; actual coverage may vary
- Focus on critical paths (API routes, data access) first
- Scripts and utilities can remain loosely typed for developer ergonomics

---

**Report Generated By:** Type Oracle Agent  
**Next Review:** After Wave 1 PR merge
